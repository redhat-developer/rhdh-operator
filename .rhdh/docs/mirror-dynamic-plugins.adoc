== Mirroring Red Hat Developer Hub Dynamic Plugins for Disconnected Environments

Red Hat Developer Hub (RHDH) uses dynamic plugins that are distributed as OCI (Open Container Initiative) artifacts. In disconnected or restricted environments, these plugin artifacts must be mirrored to a registry accessible by your cluster.

This guide explains how to use the link:./../scripts/mirror-plugins.sh[mirror-plugins.sh] script to mirror dynamic plugin OCI artifacts for deployments in restricted environments.

=== Prerequisites

The following tools are required to run the mirroring script:

* `skopeo >= 1.20` - For multi-arch image operations and manifest conversion. See link:https://github.com/containers/skopeo/blob/main/install.md[Installing Skopeo].
* `tar >= 1.35` - GNU tar for extracting image layers.
* `jq >= 1.7` - For JSON parsing and manipulation. See link:https://jqlang.github.io/jq/download/[Download jq].
* `podman >= 5.6` - For building catalog index images. See link:https://podman.io/docs/installation[Podman Installation Instructions].

=== Procedures

[#_mirroring_all_plugins_from_catalog_index]
==== Mirroring all plugins from a catalog index (Partially disconnected environment)

. Authenticate to both the source registry (`podman login quay.io`) and your target registry. For more information, see link:https://access.redhat.com/articles/RegistryAuthentication[Red Hat Container Registry Authentication].

. Run the mirroring script with the catalog index (replace `1.9` with your desired RHDH version):
+
[source,console]
----
bash mirror-plugins.sh \
    --plugin-index oci://quay.io/rhdh/plugin-catalog-index:1.9 \
    --to-registry registry.example.com
----

[#_fully_disconnected_workflow]
==== Mirroring to a fully disconnected environment

Two-phase process: export plugins to disk from a connected host, transfer to restricted network, then import. Authenticate to registries as needed (`podman login quay.io` for export, `podman login <your-registry>` for import). For more information, see link:https://access.redhat.com/articles/RegistryAuthentication[Red Hat Container Registry Authentication].

*Phase 1: Export plugins (Connected Host)*

Export all plugins to a local directory:

[source,console]
----
bash mirror-plugins.sh \
    --plugin-index oci://quay.io/rhdh/plugin-catalog-index:1.9 \
    --to-dir /tmp/rhdh-plugins
----

*Phase 2: Import plugins (Restricted Network Environment)*

Import and push the plugins to your internal registry:

[source,console]
----
bash mirror-plugins.sh \
    --from-dir /tmp/rhdh-plugins \
    --to-registry internal-registry.example.com
----

