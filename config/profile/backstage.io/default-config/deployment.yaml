# kubernetes/backstage.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backstage
spec:
  selector:
    matchLabels:
      app: backstage
  # important: keep strategy type (even if default) to allow patching it
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
  template:
    metadata:
      labels:
        app: backstage
    spec:
      containers:
        - name: backstage-backend
          image: ghcr.io/backstage/backstage:1.38.1
          imagePullPolicy: IfNotPresent
          command:
            - "node"
            - "packages/backend"
            - "--no-node-snapshot"
          args:
            - "--config"
            - "app-config.yaml"
            - "--config"
            - "app-config.production.yaml"
          ports:
            - name: http
              containerPort: 7007
#          envFrom:
#            - secretRef:
#                name: postgres-secrets
#            - secretRef:
#                name: backstage-secrets